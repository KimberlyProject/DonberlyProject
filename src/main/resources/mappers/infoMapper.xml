<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ezen.board.mappers.infoMapper">

	<!-- <resultMap id="articlesResult" type="com.ezen.board.dto.ArticleVO"> -->
	<resultMap id="articlesResult" type="buyArticleDTO">
		<result property="rnum"				column="recNum"/>
		<result property="level"			column="lvl"/>
		<result property="articleNO"		column="articleNO"/>
		<result property="userId"			column="userId"/>
		<result property="write_date"		column="write_date"/>
		<result property="title"			column="title"/>
		<result property="content"			column="content"/>
		<result property="p_code"			column="p_code"/>
		<result property="purpose"			column="purpose"/>
		<result property="view"				column="view"/>
		<result property="thumbnail"		column="thumbnail"/>
		<result property="price"			column="price"/>
	</resultMap>
	
	<!-- 게시글 검색조건 -->
	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 't'.toString()">AND TITLE	LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'c'.toString()">AND CONTENT	LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'w'.toString()">AND ID		LIKE '%' || #{keyword} || '%'</if>
		</if>
	</sql>
	
	<!-- 전체 게시글 수 구하기 (Paging 처리) -->
	<select id="infoListTotalCount1" parameterType="com.ezen.board.dto.Criteria" resultType="Integer">
		<![CDATA[
		 	SELECT	COUNT(*)
		 	FROM	article_buy
		 	WHERE	1=1
		]]>
			<include refid="search"/>
	</select>
	
	<!-- 게시글 목록 가져오기 (Paging) -->
	<!-- ROWNUM 을 가장 안 쪽에 사용하면 Mapper에서 인식을 못하기 때문에 바깥쪽에 사용하였다. -->
	<!-- rownum, level 이름으로 인해서 resultMap articlesResult 로 사용한다. -->
	<select id="infoListPaging1" parameterType="com.ezen.board.dto.Criteria" resultMap="articlesResult">
	<![CDATA[
	SELECT	*
	FROM	(
		SELECT  ROWNUM AS recNum, a.*, m.email
		FROM article_buy a, members m
        WHERE		a.userId=m.userId
 	]]>
 		<include refid='search'/>
 	<![CDATA[
     )       
	where recNum BETWEEN (#{page} - 1) * #{perPageNum} + 1 AND #{page} * #{perPageNum}
	]]>
	</select>
	
	<!-- ==================================================================================================================================================== -->
	
	<!-- 전체 게시글 수 구하기 (Paging 처리) -->
	<select id="infoListTotalCount2" parameterType="com.ezen.board.dto.Criteria" resultType="Integer">
		<![CDATA[
		 	SELECT	COUNT(*)
		 	FROM	article_sale
		 	WHERE	1=1
		]]>
			<include refid="search"/>
	</select>
	
	<!-- 게시글 목록 가져오기 (Paging) -->
	<!-- ROWNUM 을 가장 안 쪽에 사용하면 Mapper에서 인식을 못하기 때문에 바깥쪽에 사용하였다. -->
	<!-- rownum, level 이름으로 인해서 resultMap articlesResult 로 사용한다. -->
	<select id="infoListPaging2" parameterType="com.ezen.board.dto.Criteria" resultMap="articlesResult">
	<![CDATA[
	SELECT	*
	FROM	(
		SELECT  ROWNUM AS recNum, a.*, m.email
		FROM article_sale a, members m
        WHERE		a.userId=m.userId
 	]]>
 		<include refid='search'/>
 	<![CDATA[
     )       
	where recNum BETWEEN (#{page} - 1) * #{perPageNum} + 1 AND #{page} * #{perPageNum}
	]]>
	</select>
	
	
	
	
</mapper>


